import React, { FC, useEffect, useState } from 'react'

import { Breadcrumbs, ResultTable } from 'shared/components'
import { useAppSelector } from 'store'

import { breadcrumbs, headers } from './constants'
import s from '../SFCAnalyseResult/SFCAnalyseResult.module.scss'


const VulnerabilityFormationResult: FC = () => {
  const [items, setItems] = useState<string[][] | null>(null)

  const results = useAppSelector(state => state.vulnService.result)


  useEffect(() => {
    if (!results) return
    const parsedItems: string[][] = []
    results.forEach((value) => {
      const cells = [
        value.name || '-',
        value.version || '-',
        value.sfc_type?.name || '-',
        value.vulnerabilities.map(v => v.name).join(', ')
      ]
      parsedItems.push(cells)
    })
    setItems(parsedItems)
  }, [results])

  return (
    <>
      <Breadcrumbs breadcrumbs={breadcrumbs} />
      <h2 className={s.title}> Сервис формирования перечня уязвимостей - результат</h2>
      <div className={s.tableContainer}>
        {items && <ResultTable headers={headers} items={items} />}
      </div>
    </>
  )
}

export { VulnerabilityFormationResult }
